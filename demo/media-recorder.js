!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Recorder=e()}}(function(){return function e(t,i,n){function r(o,a){if(!i[o]){if(!t[o]){var c="function"==typeof require&&require;if(!a&&c)return c(o,!0);if(s)return s(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var d=i[o]={exports:{}};t[o][0].call(d.exports,function(e){var i=t[o][1][e];return r(i?i:e)},d,d.exports,e,t,i,n)}return i[o].exports}for(var s="function"==typeof require&&require,o=0;o<n.length;o++)r(n[o]);return r}({1:[function(e,t,i){"use strict";t.exports={mobile:e("./mobile"),recorderjs:e("./recorderjs"),swf:e("./swf")}},{"./mobile":2,"./recorderjs":3,"./swf":4}],2:[function(e,t,i){"use strict";var n=e("underscore"),r=e("../mixins/Observable"),s=function(e){this.initialize(e)};s.isSupported=function(){return!n.isEmpty(window.rels)&&!n.isEmpty(window.rels.mobile)},s.prototype={initialize:function(){this.Recorder=window.rels.mobile.recorder,this.recorder=new this.Recorder,this.recorder.addObserver(this,["error","playback-ended"])},startRecording:function(){this.stopPlaying(),this.stopRecording(),this.recorder.startRecord(),this.notifyObservers("onStartedRecording")},stopRecording:function(){this.recorder&&this.recorder.stopRecord()},startPlaying:function(){this.recorder.play()},stopPlaying:function(){this.recorder&&this.recorder.stop(),this.notifyObservers("onStoppedPlaying")},remove:function(){this.reset(),this.recorder.release(),delete this.recorder,this.removeObservers()},reset:function(){this.recorder&&(this.stopRecording(),this.stopPlaying())},onError:function(e){},onPlaybackEnded:function(){this.notifyObservers("onStoppedPlaying")}},r.call(s.prototype),t.exports=s},{"../mixins/Observable":7,underscore:"underscore"}],3:[function(e,t,i){"use strict";var n=e("underscore"),r=e("jquery"),s=e("../mixins/Observable"),o=e("recorderjs");e("webrtc-adapter");var a,c=function(e){this.initialize(e)};c.isSupported=function(){return navigator.mediaDevices&&"function"==typeof navigator.mediaDevices.getUserMedia&&"https:"===window.location.protocol},c.prototype={initialize:function(){window.AudioContext=window.AudioContext||window.webkitAudioContext,a=a||new window.AudioContext},startRecording:function(){this.ensureRecorder().then(n.bind(function(e){this.stopHandler(e,function(e){e.getBuffer(n.bind(this._onRecorded,this))}).record(),this.notifyObservers("onStartedRecording")},this))},ensureRecorder:function(){var e=r.Deferred();return n.delay(function(){navigator.mediaDevices.getUserMedia({audio:!0}).then(function(t){var i=a.createMediaStreamSource(t);e.resolve(new o(i))},function(t){console.log("RecorderCore#No live audio input: "+t),e.reject(t)})},0),e},startPlaying:function(){var e=a.createBufferSource();e.buffer=this.recording,e.connect(a.destination),this.stopHandler(e).start(0),this.notifyObservers("onStartedPlaying")},stop:function(){},stopRecording:function(){this.stop()},stopPlaying:function(){this.stop()},stopHandler:function(e,t){return this.stop=n.once(n.bind(function(){e.stop(),t&&t.call(this,e);var i=e instanceof o?"onStoppedRecording":"onStoppedPlaying";this.notifyObservers(i)},this)),e.onended=this.stop,e},remove:function(){this.reset(),this.removeObservers()},_audioContextError:function(e){switch(e.name){case"InvalidStateError":break;default:throw e}},reset:function(){this.recording=void 0,this.stop()},_onRecorded:function(e){var t=a.createBuffer(2,e[0].length,a.sampleRate);t.getChannelData(0).set(e[0]),t.getChannelData(1).set(e[1]),this.recording=t,this.notifyObservers("onStoppedRecording")}},s.call(c.prototype),t.exports=c},{"../mixins/Observable":7,jquery:"jquery",recorderjs:"recorderjs",underscore:"underscore","webrtc-adapter":"webrtc-adapter"}],4:[function(e,t,i){"use strict";var n=e("./swf/swfobject"),r=e("underscore"),s=e("../mixins/Observable"),o=function(e){this.initialize(e)};o.isSupported=function(){try{if(new window.ActiveXObject("ShockwaveFlash.ShockwaveFlash"))return!0}catch(e){return navigator.mimeTypes&&void 0!==navigator.mimeTypes["application/x-shockwave-flash"]&&navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin}};var a=3;o.prototype={swfSource:"recorder.swf",initialize:function(e){window.flashRecorder=this,this._events=[],this._initialized=!1,this._recording=!1,e.swfPath&&(this.swfSource=e.swfPath),this._setupFlashContainer(),this._loadFlash(),this.bind("initialized",this._onInitialized),this.bind("mp3Data",this._onDataReady),this.bind("ended",this._onEnded),this.bind("microphoneMuted",this._showFlash),this.bind("record",this._onStartedRecording)},startRecording:function(){this.flashInterface()&&this.flashInterface().recordStart()},stopRecording:function(){this._recording&&(this._recording=!1,this.flashInterface().recordStop()/1e3)},startPlaying:function(){this.flashInterface()&&this.flashInterface().playback()},stopPlaying:function(){this.flashInterface()&&this.flashInterface().playPause()},reset:function(){},remove:function(){this.flashInterface=null,document.getElementById(this.flashContainer.id)&&document.body.removeChild(this.flashContainer),this.removeObservers()},_onStartedRecording:function(){this._hideFlash(),this._recording=!0,this.notifyObservers("onStartedRecording")},_setupFlashContainer:function(){this.flashContainer=document.createElement("div"),this.flashContainer.setAttribute("id","recorderFlashContainer"),this.flashContainer.setAttribute("style","position: fixed; left: -9999px; top: -9999px; width: 230px; height: 140px;"),document.body.appendChild(this.flashContainer)},_checkForFlashBlock:function(){window.setTimeout(r.bind(function(){this._initialized||(this._flashBlockCatched=!0,this._showFlash())},this),800)},_onInitialized:function(e){this._initialized=!0,this._flashBlockCatched&&this._hideFlash()},_onDataReady:function(e){this._callbackDataReady.call(this,e)},_showFlashRequiredDialog:function(){this.flashContainer.innerHTML="<p>Adobe Flash Player 10.1 or newer is required to use this feature.</p><p><a href='http://get.adobe.com/flashplayer' target='_top'>Get it on Adobe.com.</a></p>",this.flashContainer.style.color="white",this.flashContainer.style.backgroundColor="#777",this.flashContainer.style.textAlign="center",this._showFlash()},_loadFlash:function(){var e=document.createElement("div");e.setAttribute("id","recorderFlashObject"),this.flashContainer.appendChild(e);var t={recorderInstance:"window.flashRecorder"};n.embedSWF(this.swfSource,"recorderFlashObject","231","141","10.1.0",void 0,t,{allowscriptaccess:"always"},void 0,r.bind(this._flashLoaded,this))},_flashLoaded:function(e){e.success?(this.swfObject=e.ref,this._checkForFlashBlock()):this._showFlashRequiredDialog()},_showFlash:function(){this.flashContainer.style.left=(window.innerWidth||document.body.offsetWidth)/2-115+"px",this.flashContainer.style.top=(window.innerHeight||document.body.offsetHeight)/2-70+"px"},_hideFlash:function(){this.flashContainer.style.left="-9999px",this.flashContainer.style.top="-9999px"},flashInterface:function(){return this.swfObject?this.swfObject.recordStart?this.swfObject:this.swfObject.children[a]&&this.swfObject.children[a].recordStart?this.swfObject.children[a]:void 0:null},bind:function(e,t){this._events[e]||(this._events[e]=[]),this._events[e].push(t)},triggerEvent:function(e,t,i){if(this._events[e])for(var n=0,r=this._events[e].length;n<r;n++)this._events[e][n]&&this._events[e][n].apply(this,[t,i])},_onEnded:function(){this.notifyObservers("onStoppedPlaying")}},s.call(o.prototype),t.exports=o},{"../mixins/Observable":7,"./swf/swfobject":5,underscore:"underscore"}],5:[function(e,t,i){t.exports=function(){function e(){if(!H){try{var e=L.getElementsByTagName("body")[0].appendChild(y("span"));e.parentNode.removeChild(e)}catch(t){return}H=!0;for(var i=M.length,n=0;n<i;n++)M[n]()}}function t(e){H?e():M[M.length]=e}function i(e){if(typeof P.addEventListener!=A)P.addEventListener("load",e,!1);else if(typeof L.addEventListener!=A)L.addEventListener("load",e,!1);else if(typeof P.attachEvent!=A)b(P,"onload",e);else if("function"==typeof P.onload){var t=P.onload;P.onload=function(){t(),e()}}else P.onload=e}function n(){D?r():s()}function r(){var e=L.getElementsByTagName("body")[0],t=y(I);t.setAttribute("type",k);var i=e.appendChild(t);if(i){var n=0;!function(){if(typeof i.GetVariable!=A){var r=i.GetVariable("$version");r&&(r=r.split(" ")[1].split(","),W.pv=[parseInt(r[0],10),parseInt(r[1],10),parseInt(r[2],10)])}else if(n<10)return n++,void setTimeout(arguments.callee,10);e.removeChild(t),i=null,s()}()}else s()}function s(){var e=z.length;if(e>0)for(var t=0;t<e;t++){var i=z[t].id,n=z[t].callbackFn,r={success:!1,id:i};if(W.pv[0]>0){var s=v(i);if(s)if(!g(z[t].swfVersion)||W.wk&&W.wk<312)if(z[t].expressInstall&&a()){var d={};d.data=z[t].expressInstall,d.width=s.getAttribute("width")||"0",d.height=s.getAttribute("height")||"0",s.getAttribute("class")&&(d.styleclass=s.getAttribute("class")),s.getAttribute("align")&&(d.align=s.getAttribute("align"));for(var h={},f=s.getElementsByTagName("param"),u=f.length,p=0;p<u;p++)"movie"!=f[p].getAttribute("name").toLowerCase()&&(h[f[p].getAttribute("name")]=f[p].getAttribute("value"));c(d,h,i,n)}else l(s),n&&n(r);else m(i,!0),n&&(r.success=!0,r.ref=o(i),n(r))}else if(m(i,!0),n){var y=o(i);y&&typeof y.SetVariable!=A&&(r.success=!0,r.ref=y),n(r)}}}function o(e){var t=null,i=v(e);if(i&&"OBJECT"==i.nodeName)if(typeof i.SetVariable!=A)t=i;else{var n=i.getElementsByTagName(I)[0];n&&(t=n)}return t}function a(){return!V&&g("6.0.65")&&(W.win||W.mac)&&!(W.wk&&W.wk<312)}function c(e,t,i,n){V=!0,S=n||null,x={success:!1,id:i};var r=v(i);if(r){"OBJECT"==r.nodeName?(O=d(r),_=null):(O=r,_=i),e.id=T,(typeof e.width==A||!/%$/.test(e.width)&&parseInt(e.width,10)<310)&&(e.width="310"),(typeof e.height==A||!/%$/.test(e.height)&&parseInt(e.height,10)<137)&&(e.height="137"),L.title=L.title.slice(0,47)+" - Flash Player Installation";var s=W.ie&&W.win?"ActiveX":"PlugIn",o="MMredirectURL="+encodeURI(P.location).toString().replace(/&/g,"%26")+"&MMplayerType="+s+"&MMdoctitle="+L.title;if(typeof t.flashvars!=A?t.flashvars+="&"+o:t.flashvars=o,W.ie&&W.win&&4!=r.readyState){var a=y("div");i+="SWFObjectNew",a.setAttribute("id",i),r.parentNode.insertBefore(a,r),r.style.display="none",function(){4==r.readyState?r.parentNode.removeChild(r):setTimeout(arguments.callee,10)}()}h(e,t,i)}}function l(e){if(W.ie&&W.win&&4!=e.readyState){var t=y("div");e.parentNode.insertBefore(t,e),t.parentNode.replaceChild(d(e),t),e.style.display="none",function(){4==e.readyState?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}()}else e.parentNode.replaceChild(d(e),e)}function d(e){var t=y("div");if(W.win&&W.ie)t.innerHTML=e.innerHTML;else{var i=e.getElementsByTagName(I)[0];if(i){var n=i.childNodes;if(n)for(var r=n.length,s=0;s<r;s++)1==n[s].nodeType&&"PARAM"==n[s].nodeName||8==n[s].nodeType||t.appendChild(n[s].cloneNode(!0))}}return t}function h(e,t,i){var n,r=v(i);if(W.wk&&W.wk<312)return n;if(r)if(typeof e.id==A&&(e.id=i),W.ie&&W.win){var s="";for(var o in e)e[o]!=Object.prototype[o]&&("data"==o.toLowerCase()?t.movie=e[o]:"styleclass"==o.toLowerCase()?s+=' class="'+e[o]+'"':"classid"!=o.toLowerCase()&&(s+=" "+o+'="'+e[o]+'"'));var a="";for(var c in t)t[c]!=Object.prototype[c]&&(a+='<param name="'+c+'" value="'+t[c]+'" />');r.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+s+">"+a+"</object>",$[$.length]=e.id,n=v(e.id)}else{var l=y(I);l.setAttribute("type",k);for(var d in e)e[d]!=Object.prototype[d]&&("styleclass"==d.toLowerCase()?l.setAttribute("class",e[d]):"classid"!=d.toLowerCase()&&l.setAttribute(d,e[d]));for(var h in t)t[h]!=Object.prototype[h]&&"movie"!=h.toLowerCase()&&f(l,h,t[h]);r.parentNode.replaceChild(l,r),n=l}return n}function f(e,t,i){var n=y("param");n.setAttribute("name",t),n.setAttribute("value",i),e.appendChild(n)}function u(e){var t=v(e);t&&"OBJECT"==t.nodeName&&(W.ie&&W.win?(t.style.display="none",function(){4==t.readyState?p(e):setTimeout(arguments.callee,10)}()):t.parentNode.removeChild(t))}function p(e){var t=v(e);if(t){for(var i in t)"function"==typeof t[i]&&(t[i]=null);t.parentNode.removeChild(t)}}function v(e){var t=null;try{t=L.getElementById(e)}catch(i){}return t}function y(e){return L.createElement(e)}function b(e,t,i){e.attachEvent(t,i),q[q.length]=[e,t,i]}function g(e){var t=W.pv,i=e.split(".");return i[0]=parseInt(i[0],10),i[1]=parseInt(i[1],10)||0,i[2]=parseInt(i[2],10)||0,t[0]>i[0]||t[0]==i[0]&&t[1]>i[1]||t[0]==i[0]&&t[1]==i[1]&&t[2]>=i[2]}function w(e,t,i,n){if(!W.ie||!W.mac){var r=L.getElementsByTagName("head")[0];if(r){var s=i&&"string"==typeof i?i:"screen";if(n&&(E=null,R=null),!E||R!=s){var o=y("style");o.setAttribute("type","text/css"),o.setAttribute("media",s),E=r.appendChild(o),W.ie&&W.win&&typeof L.styleSheets!=A&&L.styleSheets.length>0&&(E=L.styleSheets[L.styleSheets.length-1]),R=s}W.ie&&W.win?E&&typeof E.addRule==I&&E.addRule(e,t):E&&typeof L.createTextNode!=A&&E.appendChild(L.createTextNode(e+" {"+t+"}"))}}}function m(e,t){if(U){var i=t?"visible":"hidden";H&&v(e)?v(e).style.visibility=i:w("#"+e,"visibility:"+i)}}function C(e){var t=/[\\\"<>\.;]/,i=null!=t.exec(e);return i&&typeof encodeURIComponent!=A?encodeURIComponent(e):e}var O,_,S,x,E,R,A="undefined",I="object",j="Shockwave Flash",F="ShockwaveFlash.ShockwaveFlash",k="application/x-shockwave-flash",T="SWFObjectExprInst",N="onreadystatechange",P=window,L=document,B=navigator,D=!1,M=[n],z=[],$=[],q=[],H=!1,V=!1,U=!0,W=function(){var e=typeof L.getElementById!=A&&typeof L.getElementsByTagName!=A&&typeof L.createElement!=A,t=B.userAgent.toLowerCase(),i=B.platform.toLowerCase(),n=i?/win/.test(i):/win/.test(t),r=i?/mac/.test(i):/mac/.test(t),s=!!/webkit/.test(t)&&parseFloat(t.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")),o=!1,a=[0,0,0],c=null;if(typeof B.plugins!=A&&typeof B.plugins[j]==I)c=B.plugins[j].description,!c||typeof B.mimeTypes!=A&&B.mimeTypes[k]&&!B.mimeTypes[k].enabledPlugin||(D=!0,o=!1,c=c.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),a[0]=parseInt(c.replace(/^(.*)\..*$/,"$1"),10),a[1]=parseInt(c.replace(/^.*\.(.*)\s.*$/,"$1"),10),a[2]=/[a-zA-Z]/.test(c)?parseInt(c.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof P.ActiveXObject!=A)try{var l=new ActiveXObject(F);l&&(c=l.GetVariable("$version"),c&&(o=!0,c=c.split(" ")[1].split(","),a=[parseInt(c[0],10),parseInt(c[1],10),parseInt(c[2],10)]))}catch(d){}return{w3:e,pv:a,wk:s,ie:o,win:n,mac:r}}();(function(){W.w3&&((typeof L.readyState!=A&&"complete"==L.readyState||typeof L.readyState==A&&(L.getElementsByTagName("body")[0]||L.body))&&e(),H||(typeof L.addEventListener!=A&&L.addEventListener("DOMContentLoaded",e,!1),W.ie&&W.win&&(L.attachEvent(N,function(){"complete"==L.readyState&&(L.detachEvent(N,arguments.callee),e())}),P==top&&!function(){if(!H){try{L.documentElement.doScroll("left")}catch(t){return void setTimeout(arguments.callee,0)}e()}}()),W.wk&&!function(){if(!H)return/loaded|complete/.test(L.readyState)?void e():void setTimeout(arguments.callee,0)}(),i(e)))})(),function(){W.ie&&W.win&&window.attachEvent("onunload",function(){for(var e=q.length,t=0;t<e;t++)q[t][0].detachEvent(q[t][1],q[t][2]);for(var i=$.length,n=0;n<i;n++)u($[n]);for(var r in W)W[r]=null;W=null;for(var s in swfobject)swfobject[s]=null;swfobject=null})}();return{registerObject:function(e,t,i,n){if(W.w3&&e&&t){var r={};r.id=e,r.swfVersion=t,r.expressInstall=i,r.callbackFn=n,z[z.length]=r,m(e,!1)}else n&&n({success:!1,id:e})},getObjectById:function(e){if(W.w3)return o(e)},embedSWF:function(e,i,n,r,s,o,l,d,f,u){var p={success:!1,id:i};W.w3&&!(W.wk&&W.wk<312)&&e&&i&&n&&r&&s?(m(i,!1),t(function(){n+="",r+="";var t={};if(f&&typeof f===I)for(var v in f)t[v]=f[v];t.data=e,t.width=n,t.height=r;var y={};if(d&&typeof d===I)for(var b in d)y[b]=d[b];if(l&&typeof l===I)for(var w in l)typeof y.flashvars!=A?y.flashvars+="&"+w+"="+l[w]:y.flashvars=w+"="+l[w];if(g(s)){var C=h(t,y,i);t.id==i&&m(i,!0),p.success=!0,p.ref=C}else{if(o&&a())return t.data=o,void c(t,y,i,u);m(i,!0)}u&&u(p)})):u&&u(p)},switchOffAutoHideShow:function(){U=!1},ua:W,getFlashPlayerVersion:function(){return{major:W.pv[0],minor:W.pv[1],release:W.pv[2]}},hasFlashPlayerVersion:g,createSWF:function(e,t,i){return W.w3?h(e,t,i):void 0},showExpressInstall:function(e,t,i,n){W.w3&&a()&&c(e,t,i,n)},removeSWF:function(e){W.w3&&u(e)},createCSS:function(e,t,i,n){W.w3&&w(e,t,i,n)},addDomLoadEvent:t,addLoadEvent:i,getQueryParamValue:function(e){var t=L.location.search||L.location.hash;if(t){if(/\?/.test(t)&&(t=t.split("?")[1]),null==e)return C(t);for(var i=t.split("&"),n=0;n<i.length;n++)if(i[n].substring(0,i[n].indexOf("="))==e)return C(i[n].substring(i[n].indexOf("=")+1))}return""},expressInstallCallback:function(){if(V){var e=v(T);e&&O&&(e.parentNode.replaceChild(O,e),_&&(m(_,!0),W.ie&&W.win&&(O.style.display="block")),S&&S(x)),V=!1}}}}()},{}],6:[function(e,t,i){"use strict";var n=e("underscore"),r=e("./adapters/"),s=e("./mixins/Observable"),o=n.find(r,function(e){return e.isSupported()});o=o||r.swf;var a=function(e){this.initialize(e)};a.prototype={relay:["stopped:playing","started:recording"],initialize:function(e){this.adapter=new o(e).addObserver(this,["started:recording","stopped:playing"])},startRecording:function(){this.adapter.startRecording()},stopRecording:function(){this.adapter.stopRecording()},startPlaying:function(){this.adapter.startPlaying()},stopPlaying:function(){this.adapter.stopPlaying()},reset:function(){this.adapter.reset()},remove:function(){this.adapter.remove(),this.removeObservers()}},s.call(a.prototype),t.exports=a},{"./adapters/":1,"./mixins/Observable":7,underscore:"underscore"}],7:[function(e,t,i){"use strict";function n(e){var t=e.split(/[:|-]/),i=r.map(t,function(e){return e.charAt(0).toUpperCase()+e.substring(1).toLowerCase()});return"on"+i.join("")}var r=e("underscore");t.exports=function(){this.observe=function(e,t){return e.addObserver(this,t),this},this.unobserve=function(e,t){var i=r.pick(e._events,t);return r.each(i,function(e,t){var i=e.indexOf(this);i!==-1&&e.splice(i,1)},this),this},this.addObserver=function(e,t){return this.addObserving.call(e,this),this._events||(this._events={}),r.each([].concat(t),function(t){var i=n(t);this._events[i]||(this._events[i]=[]),this._events[i].push(e)},this),this},this.addObserving=function(e){this._observing||(this._observing=[]);var t=this._observing.indexOf(e);t===-1&&this._observing.push(e)},this.removeObserver=function(e){return r.each(this._events,function(t,i){var n=t.indexOf(e);n!==-1&&t.splice(n,1)},this),this},this.removeObservers=function(e){return this._events={},e&&r.each(this._observing,function(e){e.removeObserver(this)},this),this},this.notifyObservers=function(e){this._events||(this._events={});var t=this._events[e],i=[t,e].concat(Array.prototype.splice.call(arguments,1));return r.invoke.apply(this,i),this};var e=function(e,t){var i=n(e),s=this[i];this[i]=function(){var e=r.toArray(arguments);r.isFunction(s)&&s.apply(this,e),t&&(e=[r.result(this,t)]),e.unshift(i),this.notifyObservers.apply(this,e)}};r.each(r.extend({},this.relay),function(t){e.call(this,t)},this),r.each(r.extend({},this.broadcast),function(t){e.call(this,t,"inspect")},this),r.each(r.extend({},this.transpose),function(e,t){var i=this[t];this[t]=function(){var t=r.toArray(arguments);i&&i.apply(this,t),this.trigger&&this.trigger.apply(this,[e].concat(t))}},this);var t=this.remove;this.remove=function(){t&&t.call(this),this.removeObservers(!0)}}},{underscore:"underscore"}]},{},[6])(6)});
//# sourceMappingURL=media-recorder.js.map
