!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Recorder=e()}}(function(){return function s(o,a,c){function f(t,e){if(!a[t]){if(!o[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(l)return l(t,!0);var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}var i=a[t]={exports:{}};o[t][0].call(i.exports,function(e){return f(o[t][1][e]||e)},i,i.exports,s,o,a,c)}return a[t].exports}for(var l="function"==typeof require&&require,e=0;e<c.length;e++)f(c[e]);return f}({1:[function(e,t,n){"use strict";t.exports={mobile:e("./mobile"),recorderjs:e("./recorderjs"),swf:e("./swf")}},{"./mobile":2,"./recorderjs":3,"./swf":4}],2:[function(e,t,n){"use strict";var r=e("underscore"),i=e("../mixins/Observable"),s=function(e){this.initialize(e)};s.isSupported=function(){return!r.isEmpty(window.rels)&&!r.isEmpty(window.rels.mobile)},s.prototype={initialize:function(){this.Recorder=window.rels.mobile.recorder,this.state=1,this.recorder=new this.Recorder,this.recorder.addObserver(this,["error","playback-ended","recording-stopped","recording-started"])},startRecording:function(){this.stopPlaying(),this.recorder.startRecord(),this._setState(3)},stopRecording:function(){3===this.state&&this.stop()},startPlaying:function(){this.recorder.play(),this._setState(2)},stopPlaying:function(){2===this.state&&(this.stop(),this._onStoppedPlaying())},remove:function(){this.reset(),this.recorder.release(),delete this.recorder,this.removeObservers()},stop:function(){2===this.state&&this.recorder.stop(),3===this.state&&this.recorder.stopRecord()},reset:function(){this.recorder&&(this.stop(),this.state=1)},onError:function(e){},onRecordingStopped:function(e){1!==this.state&&(this._setState(1),this.notifyObservers("onStoppedRecording",e))},onRecordingStarted:function(){this.notifyObservers("onStartedRecording")},onPlaybackEnded:function(){2===this.state&&this._onStoppedPlaying()},_onStoppedPlaying:function(){this._setState(1),this.notifyObservers("onStoppedPlaying")},_setState:function(e){this.state=e}},i.call(s.prototype),t.exports=s},{"../mixins/Observable":7,underscore:"underscore"}],3:[function(e,t,n){"use strict";var i,s=e("underscore"),o=e("jquery"),r=e("../mixins/Observable"),a=e("../recorderjs/recorder"),c=e("../recorderjs/encodeWave");e("webrtc-adapter");var f=e("../processors/"),l=function(e){this.initialize(e)};l.isSupported=function(){return navigator.mediaDevices&&"function"==typeof navigator.mediaDevices.getUserMedia&&"https:"===window.location.protocol},l.prototype={initialize:function(){window.AudioContext=window.AudioContext||window.webkitAudioContext,window.OfflineAudioContext=window.OfflineAudioContext||window.webkitOfflineAudioContext,i=i||new window.AudioContext},startRecording:function(){var t=this;this.ensureRecorder().then(function(e){(t.recorder=e).record(),t.notifyObservers("onStartedRecording",i)})},ensureRecorder:function(){var n=o.Deferred(),r=this;return s.delay(function(){r.notifyObservers("onRecorderInitialized",i),navigator.mediaDevices.getUserMedia({audio:!0}).then(function(e){var t=i.createMediaStreamSource(e);r.notifyObservers("onMediaStreamSourceCreated",t),n.resolve(new a(t))},function(e){console.log("RecorderCore#No live audio input: "+e),n.reject(e)})},0),n},startPlaying:function(){f.Buffer.configure({recorder:this.recorder,sampleRate:i.sampleRate}).process().then(s.bind(function(e){var t=i.createBufferSource();t.buffer=e,t.connect(i.destination),t.onended=s.bind(function(){this.notifyObservers("onStoppedPlaying"),delete this.source},this),(this.source=t).start(0),this.notifyObservers("onStartedPlaying")},this))},stopRecording:function(){this.recorder&&(this.recorder.stop(),f.Buffer.configure({recorder:this.recorder,sampleRate:i.sampleRate}).process().then(f.Resample.configure({numChannels:2,sampleRate:window.webkitAudioContext?44100:16e3}).process).then(function(e){return console.log(e),e.getChannelData(0)}).then(c).then(s.bind(function(e){console.log(e),this.notifyObservers("onStoppedRecording",e)},this)))},stopPlaying:function(){this.source&&this.source.stop()},remove:function(){this.reset(),this.removeObservers()},_audioContextError:function(e){switch(e.name){case"InvalidStateError":break;default:throw e}},reset:function(){this.source&&(this.source.onended=function(){}),this.source&&this.source.stop(),this.recorder&&this.recorder.stop(),delete this.recording,delete this.recorder,delete this.source}},r.call(l.prototype),t.exports=l},{"../mixins/Observable":7,"../processors/":10,"../recorderjs/encodeWave":11,"../recorderjs/recorder":12,jquery:"jquery",underscore:"underscore","webrtc-adapter":"webrtc-adapter"}],4:[function(e,t,n){"use strict";var r=e("./swf/swfobject"),i=e("underscore"),s=e("../mixins/Observable"),o=function(e){this.initialize(e)};o.isSupported=function(){try{if(new window.ActiveXObject("ShockwaveFlash.ShockwaveFlash"))return!0}catch(e){return navigator.mimeTypes&&void 0!==navigator.mimeTypes["application/x-shockwave-flash"]&&navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin}};o.prototype={swfSource:"recorder.swf",initialize:function(e){(window.flashRecorder=this)._events=[],this._initialized=!1,this._recording=!1,this._playing=!1,e.swfPath&&(this.swfSource=e.swfPath),this._setupFlashContainer(),this._loadFlash(),this.bind("initialized",this._onInitialized),this.bind("mp3Data",this._onDataReady),this.bind("ended",this._onEnded),this.bind("microphoneMuted",this._showFlash),this.bind("record",this._onStartedRecording)},startRecording:function(){this.flashInterface()&&this.flashInterface().recordStart()},stopRecording:function(){this._recording&&(this._recording=!1,this.flashInterface().recordStop(),this.notifyObservers("onStoppedRecording"))},startPlaying:function(){this.flashInterface()&&this.flashInterface().playback(),this._playing=!0},stopPlaying:function(){this._playing&&(this.flashInterface()&&this.flashInterface().playPause(),this._onEnded())},reset:function(){},remove:function(){this.flashInterface=null,document.getElementById(this.flashContainer.id)&&document.body.removeChild(this.flashContainer),this.removeObservers()},_onStartedRecording:function(){this._hideFlash(),this._recording=!0,this.notifyObservers("onStartedRecording")},_setupFlashContainer:function(){this.flashContainer=document.createElement("div"),this.flashContainer.setAttribute("id","recorderFlashContainer"),this.flashContainer.setAttribute("style","position: fixed; left: -9999px; top: -9999px; width: 230px; height: 140px;"),document.body.appendChild(this.flashContainer)},_checkForFlashBlock:function(){window.setTimeout(i.bind(function(){this._initialized||(this._flashBlockCatched=!0,this._showFlash())},this),800)},_onInitialized:function(e){this._initialized=!0,this._flashBlockCatched&&this._hideFlash()},_onDataReady:function(e){this._callbackDataReady.call(this,e)},_showFlashRequiredDialog:function(){this.flashContainer.innerHTML="<p>Adobe Flash Player 10.1 or newer is required to use this feature.</p><p><a href='http://get.adobe.com/flashplayer' target='_top'>Get it on Adobe.com.</a></p>",this.flashContainer.style.color="white",this.flashContainer.style.backgroundColor="#777",this.flashContainer.style.textAlign="center",this._showFlash()},_loadFlash:function(){var e=document.createElement("div");e.setAttribute("id","recorderFlashObject"),this.flashContainer.appendChild(e);r.embedSWF(this.swfSource,"recorderFlashObject","231","141","10.1.0",void 0,{recorderInstance:"window.flashRecorder"},{allowscriptaccess:"always"},void 0,i.bind(this._flashLoaded,this))},_flashLoaded:function(e){e.success?(this.swfObject=e.ref,this._checkForFlashBlock()):this._showFlashRequiredDialog()},_showFlash:function(){this.flashContainer.style.left=(window.innerWidth||document.body.offsetWidth)/2-115+"px",this.flashContainer.style.top=(window.innerHeight||document.body.offsetHeight)/2-70+"px"},_hideFlash:function(){this.flashContainer.style.left="-9999px",this.flashContainer.style.top="-9999px"},flashInterface:function(){return this.swfObject?this.swfObject.recordStart?this.swfObject:this.swfObject.children[3]&&this.swfObject.children[3].recordStart?this.swfObject.children[3]:void 0:null},bind:function(e,t){this._events[e]||(this._events[e]=[]),this._events[e].push(t)},triggerEvent:function(e,t,n){if(this._events[e])for(var r=0,i=this._events[e].length;r<i;r++)this._events[e][r]&&this._events[e][r].apply(this,[t,n])},_onEnded:function(){this.notifyObservers("onStoppedPlaying"),this._playing=!1}},s.call(o.prototype),t.exports=o},{"../mixins/Observable":7,"./swf/swfobject":5,underscore:"underscore"}],5:[function(e,t,n){t.exports=function(){var c,f,l,u,a,d,w="undefined",y="object",h="Shockwave Flash",p="application/x-shockwave-flash",v="SWFObjectExprInst",e="onreadystatechange",g=window,m=document,b=navigator,x=!1,r=[function(){x?function(){var t=m.getElementsByTagName("body")[0],n=U(y);n.setAttribute("type",p);var r=t.appendChild(n);if(r){var i=0;!function(){if(typeof r.GetVariable!=w){var e=r.GetVariable("$version");e&&(e=e.split(" ")[1].split(","),O.pv=[parseInt(e[0],10),parseInt(e[1],10),parseInt(e[2],10)])}else if(i<10)return i++,setTimeout(arguments.callee,10);t.removeChild(n),r=null,B()}()}else B()}():B()}],C=[],S=[],o=[],i=!1,R=!1,s=!0,O=function(){var e=typeof m.getElementById!=w&&typeof m.getElementsByTagName!=w&&typeof m.createElement!=w,t=b.userAgent.toLowerCase(),n=b.platform.toLowerCase(),r=/win/.test(n||t),i=/mac/.test(n||t),s=!!/webkit/.test(t)&&parseFloat(t.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")),o=!1,a=[0,0,0],c=null;if(typeof b.plugins!=w&&typeof b.plugins[h]==y)!(c=b.plugins[h].description)||typeof b.mimeTypes!=w&&b.mimeTypes[p]&&!b.mimeTypes[p].enabledPlugin||(o=!(x=!0),c=c.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),a[0]=parseInt(c.replace(/^(.*)\..*$/,"$1"),10),a[1]=parseInt(c.replace(/^.*\.(.*)\s.*$/,"$1"),10),a[2]=/[a-zA-Z]/.test(c)?parseInt(c.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof g.ActiveXObject!=w)try{var f=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");f&&(c=f.GetVariable("$version"))&&(o=!0,c=c.split(" ")[1].split(","),a=[parseInt(c[0],10),parseInt(c[1],10),parseInt(c[2],10)])}catch(e){}return{w3:e,pv:a,wk:s,ie:o,win:r,mac:i}}();O.w3&&((typeof m.readyState!=w&&"complete"==m.readyState||typeof m.readyState==w&&(m.getElementsByTagName("body")[0]||m.body))&&t(),i||(typeof m.addEventListener!=w&&m.addEventListener("DOMContentLoaded",t,!1),O.ie&&O.win&&(m.attachEvent(e,function(){"complete"==m.readyState&&(m.detachEvent(e,arguments.callee),t())}),g==top&&function(){if(!i){try{m.documentElement.doScroll("left")}catch(e){return setTimeout(arguments.callee,0)}t()}}()),O.wk&&function(){i||(/loaded|complete/.test(m.readyState)?t():setTimeout(arguments.callee,0))}(),_(t)));function t(){if(!i){try{var e=m.getElementsByTagName("body")[0].appendChild(U("span"));e.parentNode.removeChild(e)}catch(e){return}i=!0;for(var t=r.length,n=0;n<t;n++)r[n]()}}function n(e){i?e():r[r.length]=e}function _(e){if(typeof g.addEventListener!=w)g.addEventListener("load",e,!1);else if(typeof m.addEventListener!=w)m.addEventListener("load",e,!1);else if(typeof g.attachEvent!=w)!function(e,t,n){e.attachEvent(t,n),o[o.length]=[e,t,n]}(g,"onload",e);else if("function"==typeof g.onload){var t=g.onload;g.onload=function(){t(),e()}}else g.onload=e}function B(){var e=C.length;if(0<e)for(var t=0;t<e;t++){var n=C[t].id,r=C[t].callbackFn,i={success:!1,id:n};if(0<O.pv[0]){var s=P(n);if(s)if(!N(C[t].swfVersion)||O.wk&&O.wk<312)if(C[t].expressInstall&&k()){var o={};o.data=C[t].expressInstall,o.width=s.getAttribute("width")||"0",o.height=s.getAttribute("height")||"0",s.getAttribute("class")&&(o.styleclass=s.getAttribute("class")),s.getAttribute("align")&&(o.align=s.getAttribute("align"));for(var a={},c=s.getElementsByTagName("param"),f=c.length,l=0;l<f;l++)"movie"!=c[l].getAttribute("name").toLowerCase()&&(a[c[l].getAttribute("name")]=c[l].getAttribute("value"));E(o,a,n,r)}else F(s),r&&r(i);else D(n,!0),r&&(i.success=!0,i.ref=A(n),r(i))}else if(D(n,!0),r){var u=A(n);u&&typeof u.SetVariable!=w&&(i.success=!0,i.ref=u),r(i)}}}function A(e){var t=null,n=P(e);if(n&&"OBJECT"==n.nodeName)if(typeof n.SetVariable!=w)t=n;else{var r=n.getElementsByTagName(y)[0];r&&(t=r)}return t}function k(){return!R&&N("6.0.65")&&(O.win||O.mac)&&!(O.wk&&O.wk<312)}function E(e,t,n,r){l=r||null,u={success:!(R=!0),id:n};var i=P(n);if(i){f="OBJECT"==i.nodeName?(c=I(i),null):(c=i,n),e.id=v,(typeof e.width==w||!/%$/.test(e.width)&&parseInt(e.width,10)<310)&&(e.width="310"),(typeof e.height==w||!/%$/.test(e.height)&&parseInt(e.height,10)<137)&&(e.height="137"),m.title=m.title.slice(0,47)+" - Flash Player Installation";var s=O.ie&&O.win?"ActiveX":"PlugIn",o="MMredirectURL="+encodeURI(g.location).toString().replace(/&/g,"%26")+"&MMplayerType="+s+"&MMdoctitle="+m.title;if(typeof t.flashvars!=w?t.flashvars+="&"+o:t.flashvars=o,O.ie&&O.win&&4!=i.readyState){var a=U("div");n+="SWFObjectNew",a.setAttribute("id",n),i.parentNode.insertBefore(a,i),i.style.display="none",function(){4==i.readyState?i.parentNode.removeChild(i):setTimeout(arguments.callee,10)}()}j(e,t,n)}}function F(e){if(O.ie&&O.win&&4!=e.readyState){var t=U("div");e.parentNode.insertBefore(t,e),t.parentNode.replaceChild(I(e),t),e.style.display="none",function(){4==e.readyState?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}()}else e.parentNode.replaceChild(I(e),e)}function I(e){var t=U("div");if(O.win&&O.ie)t.innerHTML=e.innerHTML;else{var n=e.getElementsByTagName(y)[0];if(n){var r=n.childNodes;if(r)for(var i=r.length,s=0;s<i;s++)1==r[s].nodeType&&"PARAM"==r[s].nodeName||8==r[s].nodeType||t.appendChild(r[s].cloneNode(!0))}}return t}function j(e,t,n){var r,i=P(n);if(O.wk&&O.wk<312)return r;if(i)if(typeof e.id==w&&(e.id=n),O.ie&&O.win){var s="";for(var o in e)e[o]!=Object.prototype[o]&&("data"==o.toLowerCase()?t.movie=e[o]:"styleclass"==o.toLowerCase()?s+=' class="'+e[o]+'"':"classid"!=o.toLowerCase()&&(s+=" "+o+'="'+e[o]+'"'));var a="";for(var c in t)t[c]!=Object.prototype[c]&&(a+='<param name="'+c+'" value="'+t[c]+'" />');i.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+s+">"+a+"</object>",S[S.length]=e.id,r=P(e.id)}else{var f=U(y);for(var l in f.setAttribute("type",p),e)e[l]!=Object.prototype[l]&&("styleclass"==l.toLowerCase()?f.setAttribute("class",e[l]):"classid"!=l.toLowerCase()&&f.setAttribute(l,e[l]));for(var u in t)t[u]!=Object.prototype[u]&&"movie"!=u.toLowerCase()&&L(f,u,t[u]);i.parentNode.replaceChild(f,i),r=f}return r}function L(e,t,n){var r=U("param");r.setAttribute("name",t),r.setAttribute("value",n),e.appendChild(r)}function T(e){var t=P(e);t&&"OBJECT"==t.nodeName&&(O.ie&&O.win?(t.style.display="none",function(){4==t.readyState?function(e){var t=P(e);if(t){for(var n in t)"function"==typeof t[n]&&(t[n]=null);t.parentNode.removeChild(t)}}(e):setTimeout(arguments.callee,10)}()):t.parentNode.removeChild(t))}function P(e){var t=null;try{t=m.getElementById(e)}catch(e){}return t}function U(e){return m.createElement(e)}function N(e){var t=O.pv,n=e.split(".");return n[0]=parseInt(n[0],10),n[1]=parseInt(n[1],10)||0,n[2]=parseInt(n[2],10)||0,t[0]>n[0]||t[0]==n[0]&&t[1]>n[1]||t[0]==n[0]&&t[1]==n[1]&&t[2]>=n[2]}function M(e,t,n,r){if(!O.ie||!O.mac){var i=m.getElementsByTagName("head")[0];if(i){var s=n&&"string"==typeof n?n:"screen";if(r&&(d=a=null),!a||d!=s){var o=U("style");o.setAttribute("type","text/css"),o.setAttribute("media",s),a=i.appendChild(o),O.ie&&O.win&&typeof m.styleSheets!=w&&0<m.styleSheets.length&&(a=m.styleSheets[m.styleSheets.length-1]),d=s}O.ie&&O.win?a&&typeof a.addRule==y&&a.addRule(e,t):a&&typeof m.createTextNode!=w&&a.appendChild(m.createTextNode(e+" {"+t+"}"))}}}function D(e,t){if(s){var n=t?"visible":"hidden";i&&P(e)?P(e).style.visibility=n:M("#"+e,"visibility:"+n)}}function q(e){return null!=/[\\\"<>\.;]/.exec(e)&&typeof encodeURIComponent!=w?encodeURIComponent(e):e}O.ie&&O.win&&window.attachEvent("onunload",function(){for(var e=o.length,t=0;t<e;t++)o[t][0].detachEvent(o[t][1],o[t][2]);for(var n=S.length,r=0;r<n;r++)T(S[r]);for(var i in O)O[i]=null;for(var s in O=null,swfobject)swfobject[s]=null;swfobject=null});return{registerObject:function(e,t,n,r){if(O.w3&&e&&t){var i={};i.id=e,i.swfVersion=t,i.expressInstall=n,i.callbackFn=r,C[C.length]=i,D(e,!1)}else r&&r({success:!1,id:e})},getObjectById:function(e){if(O.w3)return A(e)},embedSWF:function(o,a,c,f,l,u,d,h,p,v){var g={success:!1,id:a};O.w3&&!(O.wk&&O.wk<312)&&o&&a&&c&&f&&l?(D(a,!1),n(function(){c+="",f+="";var e={};if(p&&typeof p===y)for(var t in p)e[t]=p[t];e.data=o,e.width=c,e.height=f;var n={};if(h&&typeof h===y)for(var r in h)n[r]=h[r];if(d&&typeof d===y)for(var i in d)typeof n.flashvars!=w?n.flashvars+="&"+i+"="+d[i]:n.flashvars=i+"="+d[i];if(N(l)){var s=j(e,n,a);e.id==a&&D(a,!0),g.success=!0,g.ref=s}else{if(u&&k())return e.data=u,void E(e,n,a,v);D(a,!0)}v&&v(g)})):v&&v(g)},switchOffAutoHideShow:function(){s=!1},ua:O,getFlashPlayerVersion:function(){return{major:O.pv[0],minor:O.pv[1],release:O.pv[2]}},hasFlashPlayerVersion:N,createSWF:function(e,t,n){return O.w3?j(e,t,n):void 0},showExpressInstall:function(e,t,n,r){O.w3&&k()&&E(e,t,n,r)},removeSWF:function(e){O.w3&&T(e)},createCSS:function(e,t,n,r){O.w3&&M(e,t,n,r)},addDomLoadEvent:n,addLoadEvent:_,getQueryParamValue:function(e){var t=m.location.search||m.location.hash;if(t){if(/\?/.test(t)&&(t=t.split("?")[1]),null==e)return q(t);for(var n=t.split("&"),r=0;r<n.length;r++)if(n[r].substring(0,n[r].indexOf("="))==e)return q(n[r].substring(n[r].indexOf("=")+1))}return""},expressInstallCallback:function(){if(R){var e=P(v);e&&c&&(e.parentNode.replaceChild(c,e),f&&(D(f,!0),O.ie&&O.win&&(c.style.display="block")),l&&l(u)),R=!1}}}}()},{}],6:[function(e,t,n){"use strict";var r=e("underscore"),i=e("./adapters/"),s=e("./mixins/Observable"),o=function(e){this.Adapter=i[e.adapter]||r.find(i,function(e){return e.isSupported()})||i.swf,this.initialize(e)};o.prototype={relay:["stopped:playing","started:recording","stopped:recording","recorder:initialized","media-stream-source:created"],initialize:function(e){this.adapter=new this.Adapter(e).addObserver(this,["started:recording","stopped:playing","stopped:recording","recorder:initialized","media-stream-source:created"])},startRecording:function(){this.adapter.startRecording()},stopRecording:function(){this.adapter.stopRecording()},startPlaying:function(){this.adapter.startPlaying()},stopPlaying:function(){this.adapter.stopPlaying()},reset:function(){this.adapter.reset()},remove:function(){this.adapter.remove(),this.removeObservers()}},s.call(o.prototype),t.exports=o},{"./adapters/":1,"./mixins/Observable":7,underscore:"underscore"}],7:[function(e,t,n){"use strict";var i=e("underscore");function s(e){var t=e.split(/[:|-]/);return"on"+i.map(t,function(e){return e.charAt(0).toUpperCase()+e.substring(1).toLowerCase()}).join("")}t.exports=function(){this.observe=function(e,t){return e.addObserver(this,t),this},this.unobserve=function(e,t){var n=i.pick(e._events,t);return i.each(n,function(e,t){var n=e.indexOf(this);-1!==n&&e.splice(n,1)},this),this},this.addObserver=function(n,e){return this.addObserving.call(n,this),this._events||(this._events={}),(e||[]).forEach(i.bind(function(e){console.log(e,this);var t=s(e);this._events[t]||(this._events[t]=[]),this._events[t].push(n)},this)),console.log(this),this},this.addObserving=function(e){this._observing||(this._observing=[]),-1===this._observing.indexOf(e)&&this._observing.push(e)},this.removeObserver=function(r){return i.each(this._events,function(e,t){var n=e.indexOf(r);-1!==n&&e.splice(n,1)},this),this},this.removeObservers=function(e){return this._events={},e&&i.each(this._observing,function(e){e.removeObserver(this)},this),this},this.notifyObservers=function(e){this._events||(this._events={});var t=[this._events[e],e].concat(Array.prototype.splice.call(arguments,1));return i.invoke.apply(this,t),this};var t=function(e,t){var n=s(e),r=this[n];this[n]=function(){var e=i.toArray(arguments);i.isFunction(r)&&r.apply(this,e),t&&(e=[i.result(this,t)]),e.unshift(n),this.notifyObservers.apply(this,e)}};i.each(i.extend({},this.relay),function(e){t.call(this,e)},this),i.each(i.extend({},this.broadcast),function(e){t.call(this,e,"inspect")},this),i.each(i.extend({},this.transpose),function(t,e){var n=this[e];this[e]=function(){var e=i.toArray(arguments);n&&n.apply(this,e),this.trigger&&this.trigger.apply(this,[t].concat(e))}},this);var e=this.remove;this.remove=function(){e&&e.call(this),this.removeObservers(!0)}}},{underscore:"underscore"}],8:[function(e,t,n){var r=e("jquery"),i=e("underscore");t.exports={options:["sampleRate","recorder"],configure:function(e){return i.extend(t.exports,i.pick(e,t.exports.options)),t.exports},sampleRate:44100,recorder:void 0,process:function(){var e=t.exports.recorder,s=t.exports.sampleRate,o=r.Deferred();return i.delay(function(){e.getBuffer(function(e){for(var t=e.length,n=Math.max(e[0].length,s),r=new window.OfflineAudioContext(t,n,s).createBuffer(t,n,s),i=0;i<e.length;i++)r.getChannelData(i).set(e[i]);o.resolve(r)})},0),o}}},{jquery:"jquery",underscore:"underscore"}],9:[function(e,t,n){var o=e("jquery"),a=e("underscore");t.exports={options:["sampleRate","numChannels"],configure:function(e){return a.extend(t.exports,a.pick(e,t.exports.options)),t.exports},sampleRate:44100,numChannels:2,process:function(n){var r=o.Deferred(),i=t.exports.sampleRate,s=t.exports.numChannels;return a.delay(function(){var e=new window.OfflineAudioContext(s,n.duration*i,i),t=e.createBufferSource();t.buffer=n,t.start(0),t.connect(e.destination),e.startRendering(),e.oncomplete=function(e){r.resolve(e.renderedBuffer)}},0),r}}},{jquery:"jquery",underscore:"underscore"}],10:[function(e,t,n){var r=e("./Resample"),i=e("./Buffer");t.exports={Buffer:i,Resample:r}},{"./Buffer":8,"./Resample":9}],11:[function(e,t,n){"use strict";function i(e,t,n){for(var r=0;r<n.length;r++)e.setUint8(t+r,n.charCodeAt(r))}t.exports=function(e){var t=16*e.length/8,n=new ArrayBuffer(44+t),r=new DataView(n);return i(r,0,"RIFF"),r.setUint32(4,36+t,!0),i(r,8,"WAVE"),i(r,12,"fmt "),r.setUint32(16,16,!0),r.setUint16(20,1,!0),r.setUint16(22,1,!0),r.setUint32(24,16e3,!0),r.setUint32(28,32e3,!0),r.setUint16(32,2,!0),r.setUint16(34,16,!0),i(r,36,"data"),r.setUint32(40,t,!0),function(e,t,n){for(var r=0;r<n.length;r++,t+=2){var i=32768*n[r];e.setInt16(t,i,!0)}}(r,44,e),new Blob([r],{type:"audio/wav"})}},{}],12:[function(e,t,n){var r=function(e,t){var n=t||{},r=n.bufferLen||4096,i=n.numChannels||2;this.context=e.context,this.node=(this.context.createScriptProcessor||this.context.createJavaScriptNode).call(this.context,r,i,i);var s=new Worker(window.URL.createObjectURL(new Blob(["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error(\"Cannot find module '\"+o+\"'\")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\nvar recLength = 0,\n  recBuffers = [],\n  sampleRate,\n  numChannels;\n\nself.onmessage = function(e){\n  switch(e.data.command){\n    case 'init':\n      init(e.data.config);\n      break;\n    case 'record':\n      record(e.data.buffer);\n      break;\n    case 'exportWAV':\n      exportWAV(e.data.type);\n      break;\n    case 'getBuffer':\n      getBuffer();\n      break;\n    case 'clear':\n      clear();\n      break;\n  }\n};\n\nfunction init(config){\n  sampleRate = config.sampleRate;\n  numChannels = config.numChannels;\n  initBuffers();\n}\n\nfunction record(inputBuffer){\n  for (var channel = 0; channel < numChannels; channel++){\n    recBuffers[channel].push(inputBuffer[channel]);\n  }\n  recLength += inputBuffer[0].length;\n}\n\nfunction exportWAV(type){\n  var buffers = [];\n  for (var channel = 0; channel < numChannels; channel++){\n    buffers.push(mergeBuffers(recBuffers[channel], recLength));\n  }\n  if (numChannels === 2){\n      var interleaved = interleave(buffers[0], buffers[1]);\n  } else {\n      var interleaved = buffers[0];\n  }\n  var dataview = encodeWAV(interleaved);\n  var audioBlob = new Blob([dataview], { type: type });\n\n  self.postMessage(audioBlob);\n}\n\nfunction getBuffer(){\n  var buffers = [];\n  for (var channel = 0; channel < numChannels; channel++){\n    buffers.push(mergeBuffers(recBuffers[channel], recLength));\n  }\n  self.postMessage(buffers);\n}\n\nfunction clear(){\n  recLength = 0;\n  recBuffers = [];\n  initBuffers();\n}\n\nfunction initBuffers(){\n  for (var channel = 0; channel < numChannels; channel++){\n    recBuffers[channel] = [];\n  }\n}\n\nfunction mergeBuffers(recBuffers, recLength){\n  var result = new Float32Array(recLength);\n  var offset = 0;\n  for (var i = 0; i < recBuffers.length; i++){\n    result.set(recBuffers[i], offset);\n    offset += recBuffers[i].length;\n  }\n  return result;\n}\n\nfunction interleave(inputL, inputR){\n  var length = inputL.length + inputR.length;\n  var result = new Float32Array(length);\n\n  var index = 0,\n    inputIndex = 0;\n\n  while (index < length){\n    result[index++] = inputL[inputIndex];\n    result[index++] = inputR[inputIndex];\n    inputIndex++;\n  }\n  return result;\n}\n\nfunction floatTo16BitPCM(output, offset, input){\n  for (var i = 0; i < input.length; i++, offset+=2){\n    var s = Math.max(-1, Math.min(1, input[i]));\n    output.setInt16(offset, s < 0 ? s * 0x8000 : s * 0x7FFF, true);\n  }\n}\n\nfunction writeString(view, offset, string){\n  for (var i = 0; i < string.length; i++){\n    view.setUint8(offset + i, string.charCodeAt(i));\n  }\n}\n\nfunction encodeWAV(samples){\n  var buffer = new ArrayBuffer(44 + samples.length * 2);\n  var view = new DataView(buffer);\n\n  /* RIFF identifier */\n  writeString(view, 0, 'RIFF');\n  /* RIFF chunk length */\n  view.setUint32(4, 36 + samples.length * 2, true);\n  /* RIFF type */\n  writeString(view, 8, 'WAVE');\n  /* format chunk identifier */\n  writeString(view, 12, 'fmt ');\n  /* format chunk length */\n  view.setUint32(16, 16, true);\n  /* sample format (raw) */\n  view.setUint16(20, 1, true);\n  /* channel count */\n  view.setUint16(22, numChannels, true);\n  /* sample rate */\n  view.setUint32(24, sampleRate, true);\n  /* byte rate (sample rate * block align) */\n  view.setUint32(28, sampleRate * 4, true);\n  /* block align (channel count * bytes per sample) */\n  view.setUint16(32, numChannels * 2, true);\n  /* bits per sample */\n  view.setUint16(34, 16, true);\n  /* data chunk identifier */\n  writeString(view, 36, 'data');\n  /* data chunk length */\n  view.setUint32(40, samples.length * 2, true);\n\n  floatTo16BitPCM(view, 44, samples);\n\n  return view;\n}\n\n\n},{}]},{},[1])"],{type:"text/javascript"})));s.postMessage({command:"init",config:{sampleRate:this.context.sampleRate,numChannels:i}});var o,a=!1;this.node.onaudioprocess=function(e){if(a){for(var t=[],n=0;n<i;n++)t.push(e.inputBuffer.getChannelData(n));s.postMessage({command:"record",buffer:t})}},this.configure=function(e){for(var t in e)e.hasOwnProperty(t)&&(n[t]=e[t])},this.record=function(){a=!0},this.stop=function(){a=!1},this.clear=function(){s.postMessage({command:"clear"})},this.getBuffer=function(e){o=e||n.callback,s.postMessage({command:"getBuffer"})},this.exportWAV=function(e,t){if(o=e||n.callback,t=t||n.type||"audio/wav",!o)throw new Error("Callback not set");s.postMessage({command:"exportWAV",type:t})},s.onmessage=function(e){var t=e.data;o(t)},e.connect(this.node),this.node.connect(this.context.destination)};r.forceDownload=function(e,t){var n=(window.URL||window.webkitURL).createObjectURL(e),r=window.document.createElement("a");r.href=n,r.download=t||"output.wav";var i=document.createEvent("Event");i.initEvent("click",!0,!0),r.dispatchEvent(i)},t.exports=r},{}]},{},[6])(6)});
//# sourceMappingURL=media-recorder.js.map
