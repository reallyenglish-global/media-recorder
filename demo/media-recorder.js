!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Recorder=e()}}(function(){return function e(t,n,i){function r(o,a){if(!n[o]){if(!t[o]){var c="function"==typeof require&&require;if(!a&&c)return c(o,!0);if(s)return s(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return r(n||e)},l,l.exports,e,t,n,i)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<i.length;o++)r(i[o]);return r}({1:[function(e,t,n){"use strict";t.exports={mobile:e("./mobile"),recorderjs:e("./recorderjs"),swf:e("./swf")}},{"./mobile":2,"./recorderjs":3,"./swf":4}],2:[function(e,t,n){"use strict";var i=e("underscore"),r=e("../mixins/Observable"),s=function(e){this.initialize(e)};s.isSupported=function(){return!i.isEmpty(window.rels)&&!i.isEmpty(window.rels.mobile)},s.prototype={initialize:function(){this.Recorder=window.rels.mobile.recorder,this.state=1,this.recorder=new this.Recorder,this.recorder.addObserver(this,["error","playback-ended","recording-stopped"])},startRecording:function(){this.stopPlaying(),this.recorder.startRecord(),this._setState(3),this.notifyObservers("onStartedRecording")},stopRecording:function(){3===this.state&&(this.notifyObservers("onStoppedRecording"),this.stop(),this._setState(1))},startPlaying:function(){this.recorder.play(),this._setState(2)},stopPlaying:function(){2===this.state&&(this.stop(),this._onStoppedPlaying())},remove:function(){this.reset(),this.recorder.release(),delete this.recorder,this.removeObservers()},stop:function(){2===this.state&&this.recorder.stop(),3===this.state&&this.recorder.stopRecord()},reset:function(){this.recorder&&(this.stop(),this.state=1)},onError:function(e){},onRecordingStopped:function(){1!==this.state&&(this._setState(1),this.notifyObservers("onStoppedRecording"))},onPlaybackEnded:function(){2===this.state&&this._onStoppedPlaying()},_onStoppedPlaying:function(){this._setState(1),this.notifyObservers("onStoppedPlaying")},_setState:function(e){this.state=e}},r.call(s.prototype),t.exports=s},{"../mixins/Observable":7,underscore:"underscore"}],3:[function(e,t,n){"use strict";var i=e("underscore"),r=e("jquery"),s=e("../mixins/Observable"),o=e("../recorderjs/recorder");e("webrtc-adapter");var a,c=e("../processors/"),f=function(e){this.initialize(e)};f.isSupported=function(){return navigator.mediaDevices&&"function"==typeof navigator.mediaDevices.getUserMedia&&"https:"===window.location.protocol},f.prototype={initialize:function(){window.AudioContext=window.AudioContext||window.webkitAudioContext,a=a||new window.AudioContext},startRecording:function(){var e=this;this.ensureRecorder().then(function(t){e.recorder=t,t.record()}),this.notifyObservers("onStartedRecording")},ensureRecorder:function(){var e=r.Deferred();return i.delay(function(){navigator.mediaDevices.getUserMedia({audio:!0}).then(function(t){var n=a.createMediaStreamSource(t);e.resolve(new o(n))},function(t){console.log("RecorderCore#No live audio input: "+t),e.reject(t)})},0),e},startPlaying:function(){var e=a.createBufferSource();e.buffer=this.recording,e.connect(a.destination),e.onended=i.bind(this.stopPlaying,this),this.source=e,e.start(0),this.notifyObservers("onStartedPlaying")},stopRecording:function(){c.Buffer.configure({recorder:this.recorder,sampleRate:a.sampleRate}).process().then(c.Resample.configure({sampleRate:16e3,numChannels:1}).process).then(i.bind(function(e){this.recording=e,this.notifyObservers("onStoppedRecording")},this))},stopPlaying:function(){this.source.stop(),this.notifyObservers("onStoppedPlaying")},remove:function(){this.reset(),this.removeObservers()},_audioContextError:function(e){switch(e.name){case"InvalidStateError":break;default:throw e}},reset:function(){this.recording=void 0,this.stop()}},s.call(f.prototype),t.exports=f},{"../mixins/Observable":7,"../processors/":10,"../recorderjs/recorder":11,jquery:"jquery",underscore:"underscore","webrtc-adapter":"webrtc-adapter"}],4:[function(e,t,n){"use strict";var i=e("./swf/swfobject"),r=e("underscore"),s=e("../mixins/Observable"),o=function(e){this.initialize(e)};o.isSupported=function(){try{if(new window.ActiveXObject("ShockwaveFlash.ShockwaveFlash"))return!0}catch(e){return navigator.mimeTypes&&void 0!==navigator.mimeTypes["application/x-shockwave-flash"]&&navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin}};o.prototype={swfSource:"recorder.swf",initialize:function(e){window.flashRecorder=this,this._events=[],this._initialized=!1,this._recording=!1,this._playing=!1,e.swfPath&&(this.swfSource=e.swfPath),this._setupFlashContainer(),this._loadFlash(),this.bind("initialized",this._onInitialized),this.bind("mp3Data",this._onDataReady),this.bind("ended",this._onEnded),this.bind("microphoneMuted",this._showFlash),this.bind("record",this._onStartedRecording)},startRecording:function(){this.flashInterface()&&this.flashInterface().recordStart()},stopRecording:function(){this._recording&&(this._recording=!1,this.flashInterface().recordStop(),this.notifyObservers("onStoppedRecording"))},startPlaying:function(){this.flashInterface()&&this.flashInterface().playback(),this._playing=!0},stopPlaying:function(){this._playing&&(this.flashInterface()&&this.flashInterface().playPause(),this._onEnded())},reset:function(){},remove:function(){this.flashInterface=null,document.getElementById(this.flashContainer.id)&&document.body.removeChild(this.flashContainer),this.removeObservers()},_onStartedRecording:function(){this._hideFlash(),this._recording=!0,this.notifyObservers("onStartedRecording")},_setupFlashContainer:function(){this.flashContainer=document.createElement("div"),this.flashContainer.setAttribute("id","recorderFlashContainer"),this.flashContainer.setAttribute("style","position: fixed; left: -9999px; top: -9999px; width: 230px; height: 140px;"),document.body.appendChild(this.flashContainer)},_checkForFlashBlock:function(){window.setTimeout(r.bind(function(){this._initialized||(this._flashBlockCatched=!0,this._showFlash())},this),800)},_onInitialized:function(e){this._initialized=!0,this._flashBlockCatched&&this._hideFlash()},_onDataReady:function(e){this._callbackDataReady.call(this,e)},_showFlashRequiredDialog:function(){this.flashContainer.innerHTML="<p>Adobe Flash Player 10.1 or newer is required to use this feature.</p><p><a href='http://get.adobe.com/flashplayer' target='_top'>Get it on Adobe.com.</a></p>",this.flashContainer.style.color="white",this.flashContainer.style.backgroundColor="#777",this.flashContainer.style.textAlign="center",this._showFlash()},_loadFlash:function(){var e=document.createElement("div");e.setAttribute("id","recorderFlashObject"),this.flashContainer.appendChild(e);var t={recorderInstance:"window.flashRecorder"};i.embedSWF(this.swfSource,"recorderFlashObject","231","141","10.1.0",void 0,t,{allowscriptaccess:"always"},void 0,r.bind(this._flashLoaded,this))},_flashLoaded:function(e){e.success?(this.swfObject=e.ref,this._checkForFlashBlock()):this._showFlashRequiredDialog()},_showFlash:function(){this.flashContainer.style.left=(window.innerWidth||document.body.offsetWidth)/2-115+"px",this.flashContainer.style.top=(window.innerHeight||document.body.offsetHeight)/2-70+"px"},_hideFlash:function(){this.flashContainer.style.left="-9999px",this.flashContainer.style.top="-9999px"},flashInterface:function(){return this.swfObject?this.swfObject.recordStart?this.swfObject:this.swfObject.children[3]&&this.swfObject.children[3].recordStart?this.swfObject.children[3]:void 0:null},bind:function(e,t){this._events[e]||(this._events[e]=[]),this._events[e].push(t)},triggerEvent:function(e,t,n){if(this._events[e])for(var i=0,r=this._events[e].length;i<r;i++)this._events[e][i]&&this._events[e][i].apply(this,[t,n])},_onEnded:function(){this.notifyObservers("onStoppedPlaying"),this._playing=!1}},s.call(o.prototype),t.exports=o},{"../mixins/Observable":7,"./swf/swfobject":5,underscore:"underscore"}],5:[function(e,t,n){t.exports=function(){function e(){if(!q){try{var e=L.getElementsByTagName("body")[0].appendChild(v("span"));e.parentNode.removeChild(e)}catch(e){return}q=!0;for(var t=N.length,n=0;n<t;n++)N[n]()}}function t(e){q?e():N[N.length]=e}function n(e){if(typeof j.addEventListener!=B)j.addEventListener("load",e,!1);else if(typeof L.addEventListener!=B)L.addEventListener("load",e,!1);else if(typeof j.attachEvent!=B)g(j,"onload",e);else if("function"==typeof j.onload){var t=j.onload;j.onload=function(){t(),e()}}else j.onload=e}function i(){var e=L.getElementsByTagName("body")[0],t=v(k);t.setAttribute("type",E);var n=e.appendChild(t);if(n){var i=0;!function(){if(typeof n.GetVariable!=B){var s=n.GetVariable("$version");s&&(s=s.split(" ")[1].split(","),z.pv=[parseInt(s[0],10),parseInt(s[1],10),parseInt(s[2],10)])}else if(i<10)return i++,void setTimeout(arguments.callee,10);e.removeChild(t),n=null,r()}()}else r()}function r(){var e=M.length;if(e>0)for(var t=0;t<e;t++){var n=M[t].id,i=M[t].callbackFn,r={success:!1,id:n};if(z.pv[0]>0){var f=p(n);if(f)if(!y(M[t].swfVersion)||z.wk&&z.wk<312)if(M[t].expressInstall&&o()){var l={};l.data=M[t].expressInstall,l.width=f.getAttribute("width")||"0",l.height=f.getAttribute("height")||"0",f.getAttribute("class")&&(l.styleclass=f.getAttribute("class")),f.getAttribute("align")&&(l.align=f.getAttribute("align"));for(var u={},d=f.getElementsByTagName("param"),h=d.length,v=0;v<h;v++)"movie"!=d[v].getAttribute("name").toLowerCase()&&(u[d[v].getAttribute("name")]=d[v].getAttribute("value"));a(l,u,n,i)}else c(f),i&&i(r);else m(n,!0),i&&(r.success=!0,r.ref=s(n),i(r))}else if(m(n,!0),i){var g=s(n);g&&typeof g.SetVariable!=B&&(r.success=!0,r.ref=g),i(r)}}}function s(e){var t=null,n=p(e);if(n&&"OBJECT"==n.nodeName)if(typeof n.SetVariable!=B)t=n;else{var i=n.getElementsByTagName(k)[0];i&&(t=i)}return t}function o(){return!V&&y("6.0.65")&&(z.win||z.mac)&&!(z.wk&&z.wk<312)}function a(e,t,n,i){V=!0,S=i||null,_={success:!1,id:n};var r=p(n);if(r){"OBJECT"==r.nodeName?(x=f(r),C=null):(x=r,C=n),e.id=F,(typeof e.width==B||!/%$/.test(e.width)&&parseInt(e.width,10)<310)&&(e.width="310"),(typeof e.height==B||!/%$/.test(e.height)&&parseInt(e.height,10)<137)&&(e.height="137"),L.title=L.title.slice(0,47)+" - Flash Player Installation";var s=z.ie&&z.win?"ActiveX":"PlugIn",o="MMredirectURL="+encodeURI(j.location).toString().replace(/&/g,"%26")+"&MMplayerType="+s+"&MMdoctitle="+L.title;if(typeof t.flashvars!=B?t.flashvars+="&"+o:t.flashvars=o,z.ie&&z.win&&4!=r.readyState){var a=v("div");n+="SWFObjectNew",a.setAttribute("id",n),r.parentNode.insertBefore(a,r),r.style.display="none",function(){4==r.readyState?r.parentNode.removeChild(r):setTimeout(arguments.callee,10)}()}l(e,t,n)}}function c(e){if(z.ie&&z.win&&4!=e.readyState){var t=v("div");e.parentNode.insertBefore(t,e),t.parentNode.replaceChild(f(e),t),e.style.display="none",function(){4==e.readyState?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}()}else e.parentNode.replaceChild(f(e),e)}function f(e){var t=v("div");if(z.win&&z.ie)t.innerHTML=e.innerHTML;else{var n=e.getElementsByTagName(k)[0];if(n){var i=n.childNodes;if(i)for(var r=i.length,s=0;s<r;s++)1==i[s].nodeType&&"PARAM"==i[s].nodeName||8==i[s].nodeType||t.appendChild(i[s].cloneNode(!0))}}return t}function l(e,t,n){var i,r=p(n);if(z.wk&&z.wk<312)return i;if(r)if(typeof e.id==B&&(e.id=n),z.ie&&z.win){var s="";for(var o in e)e[o]!=Object.prototype[o]&&("data"==o.toLowerCase()?t.movie=e[o]:"styleclass"==o.toLowerCase()?s+=' class="'+e[o]+'"':"classid"!=o.toLowerCase()&&(s+=" "+o+'="'+e[o]+'"'));var a="";for(var c in t)t[c]!=Object.prototype[c]&&(a+='<param name="'+c+'" value="'+t[c]+'" />');r.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+s+">"+a+"</object>",U[U.length]=e.id,i=p(e.id)}else{var f=v(k);f.setAttribute("type",E);for(var l in e)e[l]!=Object.prototype[l]&&("styleclass"==l.toLowerCase()?f.setAttribute("class",e[l]):"classid"!=l.toLowerCase()&&f.setAttribute(l,e[l]));for(var d in t)t[d]!=Object.prototype[d]&&"movie"!=d.toLowerCase()&&u(f,d,t[d]);r.parentNode.replaceChild(f,r),i=f}return i}function u(e,t,n){var i=v("param");i.setAttribute("name",t),i.setAttribute("value",n),e.appendChild(i)}function d(e){var t=p(e);t&&"OBJECT"==t.nodeName&&(z.ie&&z.win?(t.style.display="none",function(){4==t.readyState?h(e):setTimeout(arguments.callee,10)}()):t.parentNode.removeChild(t))}function h(e){var t=p(e);if(t){for(var n in t)"function"==typeof t[n]&&(t[n]=null);t.parentNode.removeChild(t)}}function p(e){var t=null;try{t=L.getElementById(e)}catch(e){}return t}function v(e){return L.createElement(e)}function g(e,t,n){e.attachEvent(t,n),D[D.length]=[e,t,n]}function y(e){var t=z.pv,n=e.split(".");return n[0]=parseInt(n[0],10),n[1]=parseInt(n[1],10)||0,n[2]=parseInt(n[2],10)||0,t[0]>n[0]||t[0]==n[0]&&t[1]>n[1]||t[0]==n[0]&&t[1]==n[1]&&t[2]>=n[2]}function w(e,t,n,i){if(!z.ie||!z.mac){var r=L.getElementsByTagName("head")[0];if(r){var s=n&&"string"==typeof n?n:"screen";if(i&&(R=null,O=null),!R||O!=s){var o=v("style");o.setAttribute("type","text/css"),o.setAttribute("media",s),R=r.appendChild(o),z.ie&&z.win&&typeof L.styleSheets!=B&&L.styleSheets.length>0&&(R=L.styleSheets[L.styleSheets.length-1]),O=s}z.ie&&z.win?R&&typeof R.addRule==k&&R.addRule(e,t):R&&typeof L.createTextNode!=B&&R.appendChild(L.createTextNode(e+" {"+t+"}"))}}}function m(e,t){if(W){var n=t?"visible":"hidden";q&&p(e)?p(e).style.visibility=n:w("#"+e,"visibility:"+n)}}function b(e){return null!=/[\\\"<>\.;]/.exec(e)&&typeof encodeURIComponent!=B?encodeURIComponent(e):e}var x,C,S,_,R,O,B="undefined",k="object",A="Shockwave Flash",E="application/x-shockwave-flash",F="SWFObjectExprInst",I="onreadystatechange",j=window,L=document,P=navigator,T=!1,N=[function(){T?i():r()}],M=[],U=[],D=[],q=!1,V=!1,W=!0,z=function(){var e=typeof L.getElementById!=B&&typeof L.getElementsByTagName!=B&&typeof L.createElement!=B,t=P.userAgent.toLowerCase(),n=P.platform.toLowerCase(),i=/win/.test(n?n:t),r=/mac/.test(n?n:t),s=!!/webkit/.test(t)&&parseFloat(t.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")),o=!1,a=[0,0,0],c=null;if(typeof P.plugins!=B&&typeof P.plugins[A]==k)!(c=P.plugins[A].description)||typeof P.mimeTypes!=B&&P.mimeTypes[E]&&!P.mimeTypes[E].enabledPlugin||(T=!0,o=!1,c=c.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),a[0]=parseInt(c.replace(/^(.*)\..*$/,"$1"),10),a[1]=parseInt(c.replace(/^.*\.(.*)\s.*$/,"$1"),10),a[2]=/[a-zA-Z]/.test(c)?parseInt(c.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof j.ActiveXObject!=B)try{var f=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");f&&(c=f.GetVariable("$version"))&&(o=!0,c=c.split(" ")[1].split(","),a=[parseInt(c[0],10),parseInt(c[1],10),parseInt(c[2],10)])}catch(e){}return{w3:e,pv:a,wk:s,ie:o,win:i,mac:r}}();z.w3&&((typeof L.readyState!=B&&"complete"==L.readyState||typeof L.readyState==B&&(L.getElementsByTagName("body")[0]||L.body))&&e(),q||(typeof L.addEventListener!=B&&L.addEventListener("DOMContentLoaded",e,!1),z.ie&&z.win&&(L.attachEvent(I,function(){"complete"==L.readyState&&(L.detachEvent(I,arguments.callee),e())}),j==top&&function(){if(!q){try{L.documentElement.doScroll("left")}catch(e){return void setTimeout(arguments.callee,0)}e()}}()),z.wk&&function(){q||(/loaded|complete/.test(L.readyState)?e():setTimeout(arguments.callee,0))}(),n(e))),z.ie&&z.win&&window.attachEvent("onunload",function(){for(var e=D.length,t=0;t<e;t++)D[t][0].detachEvent(D[t][1],D[t][2]);for(var n=U.length,i=0;i<n;i++)d(U[i]);for(var r in z)z[r]=null;z=null;for(var s in swfobject)swfobject[s]=null;swfobject=null});return{registerObject:function(e,t,n,i){if(z.w3&&e&&t){var r={};r.id=e,r.swfVersion=t,r.expressInstall=n,r.callbackFn=i,M[M.length]=r,m(e,!1)}else i&&i({success:!1,id:e})},getObjectById:function(e){if(z.w3)return s(e)},embedSWF:function(e,n,i,r,s,c,f,u,d,h){var p={success:!1,id:n};z.w3&&!(z.wk&&z.wk<312)&&e&&n&&i&&r&&s?(m(n,!1),t(function(){i+="",r+="";var t={};if(d&&typeof d===k)for(var v in d)t[v]=d[v];t.data=e,t.width=i,t.height=r;var g={};if(u&&typeof u===k)for(var w in u)g[w]=u[w];if(f&&typeof f===k)for(var b in f)typeof g.flashvars!=B?g.flashvars+="&"+b+"="+f[b]:g.flashvars=b+"="+f[b];if(y(s)){var x=l(t,g,n);t.id==n&&m(n,!0),p.success=!0,p.ref=x}else{if(c&&o())return t.data=c,void a(t,g,n,h);m(n,!0)}h&&h(p)})):h&&h(p)},switchOffAutoHideShow:function(){W=!1},ua:z,getFlashPlayerVersion:function(){return{major:z.pv[0],minor:z.pv[1],release:z.pv[2]}},hasFlashPlayerVersion:y,createSWF:function(e,t,n){return z.w3?l(e,t,n):void 0},showExpressInstall:function(e,t,n,i){z.w3&&o()&&a(e,t,n,i)},removeSWF:function(e){z.w3&&d(e)},createCSS:function(e,t,n,i){z.w3&&w(e,t,n,i)},addDomLoadEvent:t,addLoadEvent:n,getQueryParamValue:function(e){var t=L.location.search||L.location.hash;if(t){if(/\?/.test(t)&&(t=t.split("?")[1]),null==e)return b(t);for(var n=t.split("&"),i=0;i<n.length;i++)if(n[i].substring(0,n[i].indexOf("="))==e)return b(n[i].substring(n[i].indexOf("=")+1))}return""},expressInstallCallback:function(){if(V){var e=p(F);e&&x&&(e.parentNode.replaceChild(x,e),C&&(m(C,!0),z.ie&&z.win&&(x.style.display="block")),S&&S(_)),V=!1}}}}()},{}],6:[function(e,t,n){"use strict";var i=e("underscore"),r=e("./adapters/"),s=e("./mixins/Observable"),o=function(e){this.Adapter=i.find(r,function(e){return e.isSupported()})||r.swf,this.initialize(e)};o.prototype={relay:["stopped:playing","started:recording","stopped:recording"],initialize:function(e){this.adapter=new this.Adapter(e).addObserver(this,["started:recording","stopped:playing","stopped:recording"])},startRecording:function(){this.adapter.startRecording()},stopRecording:function(){this.adapter.stopRecording()},startPlaying:function(){this.adapter.startPlaying()},stopPlaying:function(){this.adapter.stopPlaying()},reset:function(){this.adapter.reset()},remove:function(){this.adapter.remove(),this.removeObservers()}},s.call(o.prototype),t.exports=o},{"./adapters/":1,"./mixins/Observable":7,underscore:"underscore"}],7:[function(e,t,n){"use strict";function i(e){var t=e.split(/[:|-]/);return"on"+r.map(t,function(e){return e.charAt(0).toUpperCase()+e.substring(1).toLowerCase()}).join("")}var r=e("underscore");t.exports=function(){this.observe=function(e,t){return e.addObserver(this,t),this},this.unobserve=function(e,t){var n=r.pick(e._events,t);return r.each(n,function(e,t){var n=e.indexOf(this);-1!==n&&e.splice(n,1)},this),this},this.addObserver=function(e,t){return this.addObserving.call(e,this),this._events||(this._events={}),r.each([].concat(t),function(t){var n=i(t);this._events[n]||(this._events[n]=[]),this._events[n].push(e)},this),this},this.addObserving=function(e){this._observing||(this._observing=[]),-1===this._observing.indexOf(e)&&this._observing.push(e)},this.removeObserver=function(e){return r.each(this._events,function(t,n){var i=t.indexOf(e);-1!==i&&t.splice(i,1)},this),this},this.removeObservers=function(e){return this._events={},e&&r.each(this._observing,function(e){e.removeObserver(this)},this),this},this.notifyObservers=function(e){this._events||(this._events={});var t=[this._events[e],e].concat(Array.prototype.splice.call(arguments,1));return r.invoke.apply(this,t),this};var e=function(e,t){var n=i(e),s=this[n];this[n]=function(){var e=r.toArray(arguments);r.isFunction(s)&&s.apply(this,e),t&&(e=[r.result(this,t)]),e.unshift(n),this.notifyObservers.apply(this,e)}};r.each(r.extend({},this.relay),function(t){e.call(this,t)},this),r.each(r.extend({},this.broadcast),function(t){e.call(this,t,"inspect")},this),r.each(r.extend({},this.transpose),function(e,t){var n=this[t];this[t]=function(){var t=r.toArray(arguments);n&&n.apply(this,t),this.trigger&&this.trigger.apply(this,[e].concat(t))}},this);var t=this.remove;this.remove=function(){t&&t.call(this),this.removeObservers(!0)}}},{underscore:"underscore"}],8:[function(e,t,n){var i=e("jquery"),r=e("underscore");t.exports={options:["sampleRate","recorder"],configure:function(e){return r.extend(t.exports,r.pick(e,t.exports.options)),t.exports},sampleRate:44100,recorder:void 0,process:function(){var e=t.exports.recorder,n=t.exports.sampleRate,s=i.Deferred();return r.delay(function(){e.stop(),e.getBuffer(function(e){for(var t=e.length,i=e[0].length,r=new window.OfflineAudioContext(t,i,n).createBuffer(t,i,n),o=0;o<e.length;o++)r.getChannelData(o).set(e[o]);s.resolve(r)})},0),s}}},{jquery:"jquery",underscore:"underscore"}],9:[function(e,t,n){var i=e("jquery"),r=e("underscore");t.exports={options:["sampleRate","numChannels"],configure:function(e){return r.extend(t.exports,r.pick(e,t.exports.options)),t.exports},sampleRate:44100,numChannels:2,process:function(e){var n=i.Deferred(),s=t.exports.sampleRate,o=t.exports.numChannels;return r.delay(function(){var t=new window.OfflineAudioContext(o,e.duration*s,s),i=t.createBufferSource();i.buffer=e,i.start(0),i.connect(t.destination),t.startRendering().then(function(e){n.resolve(e)})},0),n}}},{jquery:"jquery",underscore:"underscore"}],10:[function(e,t,n){var i=e("./Resample"),r=e("./Buffer");t.exports={Buffer:r,Resample:i}},{"./Buffer":8,"./Resample":9}],11:[function(e,t,n){var i=function(e,t){var n=t||{},i=n.bufferLen||4096,r=n.numChannels||2;this.context=e.context,this.node=(this.context.createScriptProcessor||this.context.createJavaScriptNode).call(this.context,i,r,r);var s=new Worker(window.URL.createObjectURL(new Blob(["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error(\"Cannot find module '\"+o+\"'\")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\nvar recLength = 0,\n  recBuffers = [],\n  sampleRate,\n  numChannels;\n\nself.onmessage = function(e){\n  switch(e.data.command){\n    case 'init':\n      init(e.data.config);\n      break;\n    case 'record':\n      record(e.data.buffer);\n      break;\n    case 'exportWAV':\n      exportWAV(e.data.type);\n      break;\n    case 'getBuffer':\n      getBuffer();\n      break;\n    case 'clear':\n      clear();\n      break;\n  }\n};\n\nfunction init(config){\n  sampleRate = config.sampleRate;\n  numChannels = config.numChannels;\n  initBuffers();\n}\n\nfunction record(inputBuffer){\n  for (var channel = 0; channel < numChannels; channel++){\n    recBuffers[channel].push(inputBuffer[channel]);\n  }\n  recLength += inputBuffer[0].length;\n}\n\nfunction exportWAV(type){\n  var buffers = [];\n  for (var channel = 0; channel < numChannels; channel++){\n    buffers.push(mergeBuffers(recBuffers[channel], recLength));\n  }\n  if (numChannels === 2){\n      var interleaved = interleave(buffers[0], buffers[1]);\n  } else {\n      var interleaved = buffers[0];\n  }\n  var dataview = encodeWAV(interleaved);\n  var audioBlob = new Blob([dataview], { type: type });\n\n  self.postMessage(audioBlob);\n}\n\nfunction getBuffer(){\n  var buffers = [];\n  for (var channel = 0; channel < numChannels; channel++){\n    buffers.push(mergeBuffers(recBuffers[channel], recLength));\n  }\n  self.postMessage(buffers);\n}\n\nfunction clear(){\n  recLength = 0;\n  recBuffers = [];\n  initBuffers();\n}\n\nfunction initBuffers(){\n  for (var channel = 0; channel < numChannels; channel++){\n    recBuffers[channel] = [];\n  }\n}\n\nfunction mergeBuffers(recBuffers, recLength){\n  var result = new Float32Array(recLength);\n  var offset = 0;\n  for (var i = 0; i < recBuffers.length; i++){\n    result.set(recBuffers[i], offset);\n    offset += recBuffers[i].length;\n  }\n  return result;\n}\n\nfunction interleave(inputL, inputR){\n  var length = inputL.length + inputR.length;\n  var result = new Float32Array(length);\n\n  var index = 0,\n    inputIndex = 0;\n\n  while (index < length){\n    result[index++] = inputL[inputIndex];\n    result[index++] = inputR[inputIndex];\n    inputIndex++;\n  }\n  return result;\n}\n\nfunction floatTo16BitPCM(output, offset, input){\n  for (var i = 0; i < input.length; i++, offset+=2){\n    var s = Math.max(-1, Math.min(1, input[i]));\n    output.setInt16(offset, s < 0 ? s * 0x8000 : s * 0x7FFF, true);\n  }\n}\n\nfunction writeString(view, offset, string){\n  for (var i = 0; i < string.length; i++){\n    view.setUint8(offset + i, string.charCodeAt(i));\n  }\n}\n\nfunction encodeWAV(samples){\n  var buffer = new ArrayBuffer(44 + samples.length * 2);\n  var view = new DataView(buffer);\n\n  /* RIFF identifier */\n  writeString(view, 0, 'RIFF');\n  /* RIFF chunk length */\n  view.setUint32(4, 36 + samples.length * 2, true);\n  /* RIFF type */\n  writeString(view, 8, 'WAVE');\n  /* format chunk identifier */\n  writeString(view, 12, 'fmt ');\n  /* format chunk length */\n  view.setUint32(16, 16, true);\n  /* sample format (raw) */\n  view.setUint16(20, 1, true);\n  /* channel count */\n  view.setUint16(22, numChannels, true);\n  /* sample rate */\n  view.setUint32(24, sampleRate, true);\n  /* byte rate (sample rate * block align) */\n  view.setUint32(28, sampleRate * 4, true);\n  /* block align (channel count * bytes per sample) */\n  view.setUint16(32, numChannels * 2, true);\n  /* bits per sample */\n  view.setUint16(34, 16, true);\n  /* data chunk identifier */\n  writeString(view, 36, 'data');\n  /* data chunk length */\n  view.setUint32(40, samples.length * 2, true);\n\n  floatTo16BitPCM(view, 44, samples);\n\n  return view;\n}\n\n\n},{}]},{},[1])"],{type:"text/javascript"})));s.postMessage({command:"init",config:{sampleRate:this.context.sampleRate,numChannels:r}});var o,a=!1;this.node.onaudioprocess=function(e){if(a){for(var t=[],n=0;n<r;n++)t.push(e.inputBuffer.getChannelData(n));s.postMessage({command:"record",buffer:t})}},this.configure=function(e){for(var t in e)e.hasOwnProperty(t)&&(n[t]=e[t])},this.record=function(){a=!0},this.stop=function(){a=!1},this.clear=function(){s.postMessage({command:"clear"})},this.getBuffer=function(e){o=e||n.callback,s.postMessage({command:"getBuffer"})},this.exportWAV=function(e,t){if(o=e||n.callback,t=t||n.type||"audio/wav",!o)throw new Error("Callback not set");s.postMessage({command:"exportWAV",type:t})},s.onmessage=function(e){var t=e.data;o(t)},e.connect(this.node),this.node.connect(this.context.destination)};i.forceDownload=function(e,t){var n=(window.URL||window.webkitURL).createObjectURL(e),i=window.document.createElement("a");i.href=n,i.download=t||"output.wav";var r=document.createEvent("Event");r.initEvent("click",!0,!0),i.dispatchEvent(r)},t.exports=i},{}]},{},[6])(6)});
//# sourceMappingURL=media-recorder.js.map
